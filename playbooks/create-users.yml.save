---
- name: Playbook for creating users on servers
  hosts: linux
  become: yes
  
  tasks:
  
  - name: Test connection
    ping:

  - name: Добавить пользователя 'lnxcfg' с добавлением его в группу 'wheel'. В CentOS 7 группа 'wheel' даёт права sudo
    user:
      name: mkl
      password: $6$oy7wkV5At9TtH/yn$Ffa6yRkCshmlFf30jR.bk.2TJ/.M/PAxJLxB4RaGKoKOTpjiQU3a6MtNZ96d/aHpG30hlc5O0Ue3IRIWyf0qr/
      shell: /bin/bash
      groups: wheel
      append: yes

  - name: Создать 2048-битовый SSH ключ для lnxcfg в ~lnxcfg/.ssh/id_rsa
    user:
      name: mkl
      generate_ssh_key: yes
      ssh_key_bits: 2048
      ssh_key_file: .ssh/id_rsa

  - name: Установить authorized key из файла id_rsa.pub
    authorized_key:
      user: mkl
      state: present
      key: "{{ lookup('file', '/home/lnxcfg/.ssh/id_rsa.pub') }}"
